define(["librastandardlib/dom-utils/smoothScrollToElem","libra/dom-utils/smoothScrollOptions","libra/dom-utils/transition"],function(smoothScrollToElem,smoothScrollOptions,Transition){"use strict";var defaults={triggerSelector:".lb-accordion-trigger",groupSelector:".lb-accordion-group",contentSelector:".lb-accordion-content",expandedGroupClass:"lb-accordion-expanded",expandedGroupSelector:".lb-accordion-expanded",smoothScroll:true,collapseSiblings:true,transitionDuration:Transition.Speed.effectsDefault};function Accordion(elem){this.$elem=$(elem);this.options=$.extend({},defaults,this.$elem.data());this.$groups=this.$elem.children(this.options.groupSelector);this.$triggers=this.$groups.children(this.options.triggerSelector);this.$contents=this.$groups.children(this.options.contentSelector);this.bindHandlers()}Accordion.prototype={bindHandlers:function(){var that=this;this.$elem.on("click",this.options.triggerSelector,function(e){e.preventDefault();e.stopPropagation();that.toggle(this)})},toggle:function(trigger){var $trigger=$(trigger);var idx=this.$triggers.index($trigger);var $group=this.$groups.eq(idx);if($group.hasClass(this.options.expandedGroupClass)){this.collapse(idx,false)}else{this.expand(idx)}},expand:function(idx){var options=this.options;var $group=this.$groups.eq(idx);var trigger=this.$triggers.get(idx);var content=this.$contents.get(idx);var $content=this.$contents.eq(idx);if(options.collapseSiblings){this.collapseSiblingsOnExpand()}$group.addClass(options.expandedGroupClass);$content.css("transition-property","max-height");$content.css("max-height",content.scrollHeight);setTimeout(function(){if($group.hasClass(options.expandedGroupClass)){$content.css("max-height","none")}},options.transitionDuration);if(options.smoothScroll){smoothScrollToElem(trigger,smoothScrollOptions)}},collapse:function(idx,siblingCollapse){var $content=this.$contents.eq(idx);var content=this.$contents.get(idx);var $group=this.$groups.eq(idx);var options=this.options;$content.trigger("custom_lb_comp-content-container_close");if(siblingCollapse){$content.css("transition-property","none");$content.css("max-height",0);$group.removeClass(options.expandedGroupClass)}else{$content.css("max-height",content.scrollHeight);setTimeout(function(){$content.css("max-height",0);$group.removeClass(options.expandedGroupClass)},50)}},collapseSiblingsOnExpand:function(){var $openGroup=this.$elem.children(this.options.expandedGroupSelector);var openIndex=this.$groups.index($openGroup);if($openGroup.length>0){this.collapse(openIndex,true)}}};Libra.Comp.register({name:"accordion",initFct:function(elem){new Accordion(elem)},initTime:"documentReady"});return Accordion});
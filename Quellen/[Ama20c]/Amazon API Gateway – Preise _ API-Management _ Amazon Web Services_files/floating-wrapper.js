define(["librastandardlib/dom-utils/breakpoint-helper"],function(breakpointHelper){"use strict";var defaults={pageHeaderSelector:"#aws-page-header",floatingWrapperContentSelector:".lb-floating-wrapper-content",contentWrapperSelector:".lb-wrapper-content",resizeEventName:"resize.lb-floating-wrapper",scrollEventName:"scroll.lb-floating-wrapper",scrollPadding:30};function FloatingWrapper(elem){this.$elem=$(elem);this.options=$.extend({},defaults,this.$elem.data());this.$floatingWrapperParent=this.$elem.parent();this.$floatingWrapperContent=this.$elem.children(this.options.floatingWrapperContentSelector);this.$contentWrapper=this.$floatingWrapperContent.children(this.options.contentWrapperSelector);this.isInsideGrid=this.$floatingWrapperParent.hasClass("lb-col");this.$pageHeader=$(this.options.pageHeaderSelector);this.bindHandlers();this.onResize()}FloatingWrapper.prototype={bindHandlers:function(){var that=this;$(window).on(this.options.scrollEventName,function(){that.onScroll()});$(window).on(this.options.resizeEventName,function(){that.onResize()})},onResize:function(){var parentWidth=this.$floatingWrapperParent.width();this.$floatingWrapperContent.width(parentWidth);this.isMidUp=breakpointHelper.isMidUp();this.setFloatingColumnHeight();this.onScroll()},setFloatingColumnHeight:function(){if(!this.isMidUp){this.$elem.height("auto")}else if(this.options.explicitHeight){this.$elem.css("position","relative");this.$elem.height(this.options.explicitHeight)}},getHeaderHeight:function(){if(this.$pageHeader.length>0&&this.$pageHeader.css("position")==="fixed"){return this.$pageHeader.height()}return 0},determineFloatingHeight:function(){if(this.options.explicitHeight){return this.options.explicitHeight}else if(this.isInsideGrid){return this.$floatingWrapperParent.parent().height()}return this.$floatingWrapperParent.height()},positionFloatingContent:function(setting){if(!this.options.explicitHeight&&this.isInsideGrid){if(setting.position==="absolute"){setting.left=this.$floatingWrapperParent.position().left+this.$elem.position().left;this.$floatingWrapperParent.css("position","static")}else{this.$floatingWrapperParent.css("position","relative")}}this.$floatingWrapperContent.css(setting);this.floatingPosition=setting.position},onScroll:function(){var top;var bottom;var currentScroll;var fixedTopOffset;var relativeTopOffset;if(this.isMidUp){fixedTopOffset=this.getHeaderHeight()+this.options.scrollPadding;relativeTopOffset=this.determineFloatingHeight()-this.$contentWrapper.height();top=this.$elem.offset().top-fixedTopOffset;bottom=top+relativeTopOffset;currentScroll=$(window).scrollTop();if(this.floatingPosition!=="static"&&top>currentScroll){this.positionFloatingContent({position:"static"})}else if((this.floatingPosition!=="fixed"||this.fixedTopOffset!==fixedTopOffset)&&top<currentScroll&&currentScroll<bottom){this.positionFloatingContent({position:"fixed",top:fixedTopOffset,left:"auto"});this.fixedTopOffset=fixedTopOffset}else if(this.floatingPosition!=="absolute"&&currentScroll>bottom){this.positionFloatingContent({position:"absolute",top:"auto",bottom:0})}}else if(this.floatingPosition!=="static"){this.positionFloatingContent({position:"static"})}}};Libra.Comp.register({name:"floating-wrapper",initFct:function(elem){new FloatingWrapper(elem)},initTime:"documentReady"});return FloatingWrapper});